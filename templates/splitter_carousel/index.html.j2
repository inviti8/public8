<!doctype html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carousel</title>
  <link rel="stylesheet" href= "css/onsenui.css">
  <link rel="stylesheet" href= {{ css_theme }} >

  <script src="js/onsenui.js"></script>

  <script>
        window.fn = {};

        window.fn.open = function() {
        var menu = document.getElementById('menu');
        menu.open();
        };

        window.fn.chapterOnClick = function(el) {
            console.log(el.id)
            var carousel = document.getElementById('AppCarousel');
            var split = el.id.split("_");
            var index = parseInt(split[1]);
            console.log(index);
            console.log(carousel);
            carousel.setActiveIndex(index);
            
        }

        var prev = function() {
          var carousel = document.getElementById('AppCarousel');
          carousel.prev();
        };

        var next = function() {
          var carousel = document.getElementById('AppCarousel');
          carousel.next();
        };

        var setPageIndex = function(index) {
          var carousel = document.getElementById('AppCarousel');
          carousel.setPageIndex(index);
        };

        ons.ready(function() {
          var carousel = document.addEventListener('postchange', function(event) {
            console.log('Changed to ' + event.activeIndex)
          });
        });

        window.fn.load = function(page) {
        var content = document.getElementById('content');
        var menu = document.getElementById('menu');
        content.load(page)
            .then(menu.close.bind(menu));
        };
  </script>

  <style>
    {{ css }}
  </style>

</head>

<body>
        <ons-splitter>
                <ons-splitter-side id="menu" side="left" width="220px" collapse swipeable>
                  <ons-page>
                    <ons-list>
                      <ons-list-item onclick="fn.load('home.html')" tappable>
                        Home
                      </ons-list-item>
                      <ons-list-item onclick="fn.load('settings.html')" tappable>
                        Settings
                      </ons-list-item>
                      <ons-list-item onclick="fn.load('about.html')" tappable>
                        About
                      </ons-list-item>
                      <ons-list-item expandable>
                        Contents
                        <div class="expandable-content">
                          <ons-list>
                            {% for chapter in chapter_list %}

                              <ons-list-item tappable id= "chapter_{{ chapter_index_list[loop.index0] }}" onclick="fn.chapterOnClick(this)"> {{ chapter }}</ons-list-item>
                            {% endfor %}
                          </ons-list>
                        </div>
                      </ons-list-item>
                    </ons-list>
                  </ons-page>
                </ons-splitter-side>
                <ons-splitter-content id="content" page="home.html"></ons-splitter-content>
              </ons-splitter>
              
              <template id="home.html">
                <ons-page>
                  <ons-toolbar>
                    <div class="left">
                      <ons-toolbar-button onclick="fn.open()">
                        <ons-icon icon="md-menu"></ons-icon>
                      </ons-toolbar-button>
                    </div>
                    <div class="center">
                      {{ title }}
                    </div>
                  </ons-toolbar>
                  <ons-page>
                        <ons-carousel id="AppCarousel" initial-index="0" swipeable overscrollable auto-scroll auto-refresh fullscreen auto-scroll-ratio="0.2" direction={{ page_direction }}>
                        {% for content in content_list %}
                        <ons-carousel-item overflow-y: scroll; height:90vh;><div class="page" > {{ content }} </div></ons-carousel-item>
                        {% endfor %}
                    </ons-page>
                </ons-page>
              </template>
              
              <template id="settings.html">
                <ons-page>
                  <ons-toolbar>
                    <div class="left">
                      <ons-toolbar-button onclick="fn.open()">
                        <ons-icon icon="md-menu"></ons-icon>
                      </ons-toolbar-button>
                    </div>
                    <div class="center">
                      Settings
                    </div>
                  </ons-toolbar>
                </ons-page>
              </template>
              
              <template id="about.html">
                <ons-page>
                  <ons-toolbar>
                    <div class="left">
                      <ons-toolbar-button onclick="fn.open()">
                        <ons-icon icon="md-menu"></ons-icon>
                      </ons-toolbar-button>
                    </div>
                    <div class="center">
                      About
                    </div>
                  </ons-toolbar>
                </ons-page>
              </template>
    

</body>
</html>